<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Checkout</title>

  <!-- font awesome cdn link -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"
    integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

  <!-- custom css file link -->
  <link rel="stylesheet" href="css/checkout.css">

</head>

<body>

  <!-- header section starts   -->
  <header class="header">

    <section class="flex">

      <a href="#home" class="logo"><img src="images/logo.png" alt=""></a>

      <nav class="navbar">
        <a href="index.html#home">home</a>
        <a href="index.html#about">about</a>
        <a href="menu.html">menu</a>
        <a href="index.html#gallery">gallery</a>
        <a href="index.html#team">team</a>
        <a href="index.html#contact">contact</a>
      </nav>

      <div id="menu-btn" class="fas fa-bars"></div>

    </section>

  </header>
  <!-- header section ends   -->

  <!-- home section starts -->
  <!--   <div class="home-bg">

  <section class="home" id="home">

    <div class="content">
      <h3>Coffee heaven</h3>
      <p>Coffee Heaven is a haven for coffee enthusiasts and caffeine aficionados alike.
        This cozy, aromatic oasis beckons with the promise of rich,
        freshly brewed coffee that awakens the senses and warms the soul.
        From the moment you step inside.</p>
      <a href="#about" class="btn">about us</a>
    </div>

  </section>

</div> -->
  <!-- home section ends -->

  <!-- about section starts -->
  <!--   <section class="about" id="about">

  <div class="image">
    <img src="images/about-img.svg" alt="">
  </div>

  <div class="content">
    <h3>A cup of coffee can complete your day</h3>
    <p>A cup of coffee has the remarkable ability to complete your day in the most satisfying way.
      Its aroma alone can awaken your senses, and that first sip delivers a burst of warmth and
      comfort that's unmatched. Whether it's the morning ritual that kickstarts your day or the
      afternoon pick-me-up that fuels your productivity,
      coffee is a trusted companion.</p>
    <a href="#menu" class="btn">our menu</a>
  </div>

</section> -->
  <!-- about section ends -->

  <!-- facility section starts -->
  <!--   <section class="facility">

  <div class="heading">
    <img src="images/heading-img.png" alt="">
    <h3>Our facility</h3>
  </div>

  <div class="box-container">

    <div class="box">
      <img src="images/icon-1.png" alt="">
      <h3>varieties of coffees</h3>
      <p>There are numerous varieties of coffee available around the world,
        each with its unique flavor profiles,
        growing conditions, and processing methods.</p>
    </div>

    <div class="box">
      <img src="images/icon-2.png" alt="">
      <h3>Coffee beans</h3>
      <p>Coffee beans are the seeds of the Coffea plant, and they are used to make
        the beverage we know as coffee.</p>
    </div>

    <div class="box">
      <img src="images/icon-3.png" alt="">
      <h3>breakfast and sweets</h3>
      <p>Breakfast and sweets are two distinct categories of food,
        each with its own array of dishes and treats. </p>
    </div>

    <div class="box">
      <img src="images/icon-4.png" alt="">
      <h3>read to go coffee</h3>
      <p>It seems like you're interested in "ready-to-go" coffee options. Ready-to-go coffee
        typically refers to coffee that is pre-made or pre-packaged,
        allowing for convenient and quick consumption.</p>
    </div>

  </div>

</section> -->
  <!-- facility section ends -->

  <!-- menu section starts -->
  <!--  <section class="menu" id="menu">
 
   <div class="heading">
     <img src="images/heading-img.png" alt="">
     <h3>popular menu</h3>
   </div>
 
   <div class="box-container">
 
     <div class="box">
       <img src="images/menu-1.png" alt="">
       <h3>love you coffee</h3>
     </div>
 
     <div class="box">
       <img src="images/menu-2.png" alt="">
       <h3>Cappuccino</h3>
     </div>
 
     <div class="box">
       <img src="images/menu-3.png" alt="">
       <h3>Mocha coffee</h3>
     </div>
 
     <div class="box">
       <img src="images/menu-4.png" alt="">
       <h3>Frappuccino</h3>
     </div>
 
     <div class="box">
       <img src="images/menu-5.png" alt="">
       <h3>black coffee</h3>
     </div>
 
     <div class="box">
       <img src="images/menu-6.png" alt="">
       <h3>love heart coffee</h3>
     </div>
 
   </div>
 
 </section> -->
  <!-- menu section ends -->

  <!-- gallery section starts -->
  <!-- <section class="gallery" id="gallery">
  
    <div class="heading">
      <img src="images/heading-img.png" alt="">
      <h3>Our gallery</h3>
    </div>
  
    <div class="box-container">
      <img src="images/gallery-1.webp" alt="">
      <img src="images/gallery-2.webp" alt="">
      <img src="images/gallery-3.webp" alt="">
      <img src="images/gallery-4.webp" alt="">
      <img src="images/gallery-5.webp" alt="">
      <img src="images/gallery-6.webp" alt="">
    </div>
  
  </section> -->
  <!-- gallery section ends -->

  <!-- team section starts -->
  <!--   <section class="team" id="team">

  <div class="heading">
    <img src="images/heading-img.png" alt="">
    <h3>Our team</h3>
  </div>

  <div class="box-container">

    <div class="box">
      <img src="images/our-team-1.jpg" alt="">
      <h3>Kartik Chavan</h3>
    </div>
    <div class="box">
      <img src="images/our-team-2.jpg" alt="">
      <h3>Rajdip Patil</h3>
    </div>
    <div class="box">
      <img src="images/our-team-3.jpg" alt="">
      <h3>Navkar Bedmutha</h3>
    </div>
  </div>

</section> -->
  <!-- team section ends -->

  <!-- contact section starts -->
  <!-- Popup Card -->
  <div class="popup-overlay" id="popup" style="display: none;">
    <div class="popup-card">
      <span class="close-btn" id="closePopup">&times;</span>
      <h2>Scan Me</h2>
      <img id="qrCodeImage" src="../images/upi.png" alt="upi">
      <div id="timeLeftDiv">0:00</div>
      <!-- <button class="btn">Action</button> -->

    </div>
  </div>

  <!-- popup card -->
  <section class="contact" id="contact">

    <div class="heading">
      <img src="images/heading-img.png" alt="">
      <h3>CheckOut</h3>
    </div>

    <div class="row">

      <!--   <div class="image">
      <img src="images/contact-img.svg" alt="">
    </div> -->

      <form id="contactForm">
        <h3>Checkout</h3>

        <input type="text" name="name" id="name" required class="box" maxlength="20" placeholder="Name">

        <input type="email" name="email" id="email" required class="box" maxlength="20" placeholder="Email">

        <input type="number" name="number" id="number" required class="box" maxlength="20" placeholder="Mobile" min="0"
          max="9999999999" onkeypress="if(this.value.length == 10) return false">

        <textarea name="address" class="box" id="address" rows="3" cols="10" placeholder="Address" required></textarea>

        <input type="text" name="item-name" id="item-name" required class="box" placeholder="Item Name" disabled>

        <input type="number" name="quantity" id="quantity" required class="box" maxlength="2" placeholder="quantity"
          onkeypress="if(this.value.length == 2) return false" oninput="updatePrice(this.value)">


        <input type="number" name="amount" id="amount" required class="box" maxlength="20" placeholder="Amount" disabled
          value="0.00">

        <div class="box radio-btn">
          <input type="radio" name="payment-method" id="upi" value="UPI" required>
          <label for="upi"><img id="upi-logo" src="./images/upi.png" alt="UPI"></label>
        </div>

        <div class="box radio-btn">
          <input type="radio" class="box" name="payment-method" id="cod" value="COD" required>
          <label for="cod">COD (Cash on Delivery)</label>
        </div>


        <div class="btn-container">
          <input type="submit" id="SubmitBtn" value="Pay Now" class="btn">
          <div class="spinner-border loader" id="loader" role="status"></div>
        </div>
      </form>

    </div>

  </section>
  <!-- contact section ends -->

  <!-- footer section starts -->
  <section class="footer">

    <div class="box-container">

      <div class="box">
        <i class="fas fa-envelope"></i>
        <h3>Our email</h3>
        <p>sandipstudents@gmail.com</p>

      </div>

      <!-- <div class="box">
        <i class="fas fa-clock"></i>
        <h3>Opening hours</h3>
        <p>07:00am to 10:00pm</p>
      </div> -->

      <div class="box">
        <i class="fas fa-map-marker-alt"></i>
        <h3>shop location</h3>
        <p>Nashik, CBS -422213</p>
      </div>

      <div class="box">
        <i class="fas fa-phone"></i>
        <h3>Contact number</h3>
        <p>+918275648835</p>

      </div>

    </div>

    <div class="credit"> &copy; copyright @ 2024 by <a href="https://www.instagram.com/rajdip.585"><span>Rajdip
          Patil</span> </a>| All rights reserved! </div>

  </section>
  <!-- footer section ends -->









  <!-- custom js file link -->
  <script src="js/script.js"></script>
  <script>
    // Get the query string from the URL
    const queryString = window.location.search;

    // Create a URLSearchParams object
    const params = new URLSearchParams(queryString);

    // Store values into variables
    const get_item_name = params.get('name') || ""; // Replace 'name' with the actual key
    let price = params.get('amount') || 0.00; // Replace 'age' with the actual key


    document.getElementById("item-name").value = get_item_name;

    //update price on quantity input

    function updatePrice(quantity) {
      document.getElementById("amount").value = (price * quantity).toFixed(2);
    }




    document.getElementById('SubmitBtn').addEventListener('click', function (event) {
      // Prevent form submission for demonstration purposes
      event.preventDefault();

      // Get all radio buttons with name 'payment-method'
      const paymentMethods = document.getElementsByName('payment-method');

      let selectedValue = null;

      // Loop through the radio buttons to find the selected one
      for (const method of paymentMethods) {
        if (method.checked) {
          selectedValue = method.value;
          break;
        }
      }

      let name = document.getElementById("name").value;
      let email = document.getElementById("email").value;
      let number = document.getElementById("number").value;
      let address = document.getElementById("address").value;
      let item_name = document.getElementById("item-name").value;
      let quantity = document.getElementById("quantity").value;
      let amount = document.getElementById("amount").value;

      if (!name || !email || !number || !address || !item_name || !quantity || !selectedValue) {
        alert("All fields must be filled out.");
        return;
      }

      fetch('https://sandip.freewebhostmost.com/project/save_order.php', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: new URLSearchParams({
          name: name,
          email: email,
          mobile: number,
          quantity: quantity,
          item_name: item_name,
          address: address,
          amount: amount,
          mode: selectedValue,
        }),
      })
        .then(response => {
          if (response.ok) {
            return response.json(); // Parse the JSON response
          } else {
            throw new Error('Network response was not ok');
          }
        })
        .then(data => {
          // Assuming `data` contains a message or order details
          if (data.status === 201) { // Check if the response indicates success
            swal("Order received successfully!", `Order ID: ${data.order_id}`, "success");
          } else if (data.status === 200) {
            // SHow UPI QR
            sendPostRequest(data.order_id);
            document.getElementById('qrCodeImage').src = "data:image/png;base64," + data.qr_data; // Assuming `qrCodeUrl` contains the QR code image URL
            document.getElementById("popup").style.display = "flex";
          }
          else {
            alert("Order failed"); // Handle failure messages from the API
          }
        })
        .catch(error => {
          // alert("Something went wrong: " + error.message);
          console.error("Error Details:", error);
        });

    });

    async function sendPostRequest(id) {
      const url = "https://sandip.freewebhostmost.com/project/check_status.php";
      const payload = { order_id: id };
      const timeout = 1 * 60 * 1000; // 2 minutes in milliseconds
      const startTime = Date.now();

      // Get the div where the remaining time will be displayed
      const timeLeftDiv = document.getElementById('timeLeftDiv');

      while (true) {
        try {
          // Calculate the remaining time
          const elapsedTime = Date.now() - startTime;
          const remainingTime = timeout - elapsedTime;

          // If time is left, update the display
          if (remainingTime > 0) {
            const remainingSeconds = Math.floor(remainingTime / 1000);
            const minutes = Math.floor(remainingSeconds / 60);
            const seconds = remainingSeconds % 60;

            // Display the time left in the div
            timeLeftDiv.textContent = `Time Left: ${minutes}m ${seconds}s`;
          } else {
            // If time is over, stop the loop and display timeout message
            document.getElementById("popup").style.display = "none";
            timeLeftDiv.textContent = "Time is up! Request stopped.";
            swal("Expired!", "Your payment request is expired", "error");
            break;
          }

          // Sending the POST request with AJAX
          const response = await $.ajax({
            url: url,
            type: "POST",
            data: payload,
            contentType: "application/x-www-form-urlencoded",
          });

          if (response.status == 200) {
            document.getElementById("popup").style.display = "none";
            swal("Order Placed!", "You will receive your order soon", "success");
            break;
          } else if (response.status == 250) {
            //console.log("Continuing the loop...");
          } else {
            console.error("Unexpected status:", response.status);
            break;
          }

          // Wait for 1 second before retrying
          await new Promise(resolve => setTimeout(resolve, 1000));

        } catch (error) {
          console.error("Error in status check:", error);
          break;
        }
      }
    }
  </script>

  <script>
    const openPopup = document.getElementById('openPopup');

    const closePopup = document.getElementById('closePopup');

    const popup = document.getElementById('popup');
    // popup.style.display = 'flex';
    // Close popup
    closePopup.addEventListener('click', () => {
      popup.style.display = 'none';
    });


    // Close popup on outside click
    popup.addEventListener('click', (e) => {
      if (e.target === popup) {
        popup.style.display = 'none';
      }
    });
  </script>
</body>

</html>
